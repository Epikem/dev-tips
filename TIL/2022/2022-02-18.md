# log 2022-02-18

---

- [blog](#blog)
- [job](#job)
  - [GOP-14151 작업](#gop-14151-작업)
- [tags](#tags)

## blog

아.. copilot 막혔다.
막힐만하지.
liveshare만은..

근데 liveshare 막혀도 되지 않나? remote 안되나? vdi에서 되는 걸 보면 또 방법이 있을지도.
해봤는데 일단 local에선 안된다. 음..

vpn도 열어야만 접속되는데 ssh정돈 괜찮지 않나..? 그거만 되어도 편할텐디.
ip를보니, vdi ip, vpn ip, ubuntu ip 모두 그리 비슷하지 않은 듯하다.
흐으음...

live share가 자꾸 터미널이 깨지는 문제가 있어서, ssh만 되어도 참 편할텐데...

## job

### GOP-14151 작업 - 구조 변경

일단 이중화를 하든 안하든 람다 테스트/구현이 필요하다. 그런데, 람다 배포 방법 모르고, 어디에 배포해야 하는지도 모른다. vpc랑 람다 영역 연결도 필요할텐데..

아무래도, 확장성을 위해서는 수신/송신 채널을 분리해야 할 듯하다.
어차피 소켓이 읽고쓰기 가능하므로 그걸 이용해서 보낸 람다가 응답받고 리턴하게 하려 했는데, 이런 구조로는 이중화/확장이 어렵다.
로드밸런서는 응답을 어떤 서버로 매칭시키고, 그 서버가 client에게 보내는 응답을 돌려준다.
또는 릴레이가 요청을 보낸 람다의 응답을 제대로 돌려줄 수 있으면 되는데, 그러려면 릴레이가 메시지 내용을 일부 해석해야 한다. 고정길이니까 괜찮을 수도. 그런데 결국 어쨌든, 송수신을 릴레이가 따로 병렬적으로 처리할 필요가 있다. 그렇게 되면 결국 어느 람다로 응답을 돌려줘야 할 지 모르게 되고, 결국 그냥 송수신 라인이 분리되는게 낫다..

일단, 테스트를 위해서는, 수신 무조건 보여주고, 송신 자유롭게 해서 할 필요가 있다.

근데 메시지 형식에 대해 궁금한 점들이 있다.

한 4~5가지 정보를 모른다. 나머지는 알잘딱 하더라도.

바텀-업, 탑-다운, 다른 분들은 어떤 식으로 하실까?
일단 걍 코드에서 대충이라도 해보고, 쪼개가며 람다로 만들고 그런 식으로 할지, 아니면 람다, 네트워크, c8n 이런거부터 설정하고 가는지..

난 코드부터 대충 해봤는데, 결국 큰 단위 문제인 이중화를 할 수 없는 코드를 짜버렸다.
물론 쪼개면 되지만, 결국 또 다시 하는것에 가까운거같기도...

- 람다 함수 배포방법 시도중 에러 발생.
- 먼저 인스턴스 내에서 테스트 가능하도록 프로토콜 작성 예정
- 이중화

- 부하, 스케일링
- 배포준비
- 네트워크
- 포맷 맞추기
- 업무 개시 주기 및 폴링 기능 주기

생각해보자, 저 내용을 결국 람다가 채워서 만들어주어야 하는데, 나머지 정보는 그렇다 쳐도, 람다가 그러면 번호와 같은 정보를 어떤 규칙으로 만들지 알아야 할 텐데, 람다들이 병렬로 실행된다면 1씩 증가시키는 것을 어떻게 할 수 있나..?
그냥 랜덤 값으로 해야하나? 만약 그러다가 번호가 겹치면?

결국 프로토콜 작업을 못했다.

시간이 없으므로 어떻게든 해야 한다.

### GOP-14151 - 프로토콜 작업

distributed unique increasing id에 대해 검색해봐도 잘 안나오고, sqs도 messageId필드는 string이라.. 결국 어떤 단일 서버가 id를 지정해 주지 않으면 어려울 듯하다. 또는 request 서버를 하나로 두고, active-standby를 쓰거나..

다른건 몰라도 lambda 호출 패킷을 직접 만드는 부분은 좀 피하고 싶은데..


## tags

- blog
- study
- aws
- architecture

---
