# TIL 2020-10-11

--------------------------

## 할 일
- [x] 테스트 케이스 추가
- [x] 그래프 알고리즘 구상
- [ ] Readme 작성

## 배운 것 & 한것

### 테스트 케이스 추가

복잡한 상황에 대한 테스트 케이스를 추가했다.


### 그래프 알고리즘 구상

차수를 추적하고 보여주기 위해서는, 각 사용자에 대해 누구로부터 접촉되었는지를 알아야 할 것이다. 또한 다음과 같은 애매한 상황들에 대해서 어떻게 처리해야할 지 생각해야한다. 그리고 효율적으로 하려면 쿼리를 어떻게 해야 할지도.

문제점들:

- 이전 접촉자가 둘 이상인 경우 누구를 기준으로 계산할지 
 기본적으로 접촉 차수가 더 낮은 접촉자를 기준으로 접촉 차수를 계산하면 되지만, 그 둘 다 접촉 차수가 같다면 애매해진다.

- 서버 및 데이터베이스 부하를 줄이기 위해 쿼리를 최적화할 필요가 있다. 그런데, 접촉 차수의 경우 그래프 처럼 접촉을 연속하여 깊어질 수가 있는데, 만약에 저녁과 같은 특정 시간에 차수 계산을 몰아서 하게 한다고 해도, 사용자의 데이터베이스상 위치 등에 따라, 한 번의 스캔으로 모든 접촉자의 접촉 차수를 찾을 수 없다는 문제가 있다. 예를 들어 다음과 같은 경우가 있다.

1. 갑과 을이 접촉
2. 갑이 확진
3. 을과 병이 접촉
4. 그런데 db상으로 병 을 갑 순으로 배치

그러면 이제 한 번의 스캔에 대해 작업을 생각해보자.
1. 병을 처리한다. (접촉차수 계산)
현재 db상태에서는 병과 을 모두 접촉자가 아니므로 아무 일도 발생하지 않는다.

2. 을을 처리한다. (접촉차수 계산)
갑이 확진자이므로 을이 접촉자가 된다.
(이 단계에서 을에 대해 다시 스캔하는가? 그러면 성능이 떨어진다.)

3. 갑을 처리한다. (접촉차수 계산)
을이 이미 접촉자이므로 아무 일도 발생하지 않는다.

이러한 일이 발생하므로, 3차 차수까지 계산하려면 최소 세 번의 db스캔이 필요하게 된다.

그래서 차수 계산을 위한 선택지는 다음과 같이 두 가지가 있다:
1. 차수 n에 따라 n번의 스캔 및 처리
2. 재귀적 처리

그런데 보통 스케일이 커진다고 생각해보면 재귀적 처리가 더 느려질거같은데..

쿼리 최적화 등에 대해 정확하게 아는 것이 아니므로 잘 모르겠다..






## tags
- \#TIL, \#blog, \#prj, \#swm, \#capstone

--------------------------